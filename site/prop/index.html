

<!doctype html>
<html>
<head>
  <meta charset="utf8">
  <title>sql.js demo: Online SQL interpreter</title>


<script src='../js/sql.js'></script>
<script src="https://cdn.bootcss.com/mathjs/4.0.1/math.js"></script>

</head>
<body>



  <div data-role="page">
   <div data-role="content">
    <button type="button" class="btn btn-default"  onclick = "searchProp()">查找</button>
   </div>


 <div data-role="content">
  <button type="button" class="btn btn-default"  onclick = "plot()">默认按钮</button>
 </div>

 <select name="mySelect" id="mySelect">

</select>

<script>
  function print(value) {
      var precision = 14;
      document.write(math.format(value, precision) + '<br>');
    }

</script>



<script src="https://cdn.bootcss.com/echarts/4.0.4/echarts.min.js"></script>



<script type="text/javascript">
function searchProp(){
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '../propDB.db', true);
  xhr.responseType = 'arraybuffer';
  var mySelect =document.getElementById('mySelect');
  mySelect.id = "mySelect";

  xhr.onload = function(e) {
  var uInt8Array = new Uint8Array(this.response);
  var db = new SQL.Database(uInt8Array);
  var qstr ="SELECT propName FROM propellers WHERE propName like '%" + "10" + "%' group by propName";
  //window.alert(qstr); 
  var contents = db.exec(qstr);
  //print(contents[0].values);
  for(i=0;i<contents[0].values.length;i++){
  //  document.write("<option value =\"" + contents[0].values[i] +"\"" + contents[0].values[i] +"</option>")o;
    //window.alert(contents[0].values[i]+' ');
    mySelect.add(new Option(contents[0].values[i],contents[0].values[i]));
  }
  };
  xhr.send();
  //document.write("</select>");
}
</script>

<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="width: 600px;height:400px;"></div>
<script type="text/javascript">
function plot(){
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '../propDB.db', true);
  xhr.responseType = 'arraybuffer';

  xhr.onload = function(e) {
  var uInt8Array = new Uint8Array(this.response);
  var db = new SQL.Database(uInt8Array);
  var obj=document.getElementById('mySelect');
  var index = obj.selectedIndex;
  var qstr = "SELECT V,Thrust FROM propellers WHERE propName = '" + obj.options[index].value+"' AND RPM = '3000'";
   
  var contents = db.exec(qstr);
  //print(contents[0].values);
  //window.alert(qstr);
  for(i=0;i<contents[0].values.length;i++)
  {//query values
    //document.write(contents[0].values[i]+' ');

  }
  var myChart = echarts.init(document.getElementById('main'));

  var option = {
   title : {
        text: '推力-速度曲线',
    },
    xAxis: { axisLabel : {
                formatter: '{value} m/s'
            }},
    yAxis: {
       axisLabel : {
                formatter: '{value} N'
            }
    },
    series: [{
        data: contents[0].values,
        type: 'line',
        smooth : true
    }]
  };
  myChart.setOption(option);
};
//  document.write(contents);
//  db.each("SELECT V,Thrust FROM propellers WHERE propName = '10.5x4.5' AND RPM = '3000'",
//                  {$majority:18},
//                  function(row){document.write(row.V * 0.44704 + " m/s " + row.Thrust * 0.45359 + "Kgf \n")}
//              );

  xhr.send();
}

   </script>


</div>
</body>
</html>